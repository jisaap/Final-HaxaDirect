<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="prof2">

	<select id="selectInMajor" parameterType="selectInMajor" resultMap="studentResult">
		SELECT STU_NO, STU_NAME, GENDER, STU_TEL, STU_EMAIL, 
			   STU_ADDR, REG_STATUS, DEPT_CODE, 
			   SUBSTR(STU_YEAR_SEM,1) AS GRADE
		
		FROM HD_STUDENT_TB 
		
		WHERE 1 = 1 
		<if test='stuNo !="" &amp; stuNo != null'>
			AND STU_NO = #{stuNo}
		</if>
		<if test='stuName !="" &amp; stuName != null'>
			AND STU_NAME = #{stuName}
		</if>
		<if test='grade !="" &amp; grade != null'>
			AND SUBSTR(STU_YEAR_SEM,1,1) = #{grade} 
		</if>
			AND DEPT_CODE = #{deptCode} 
			ORDER BY STU_NAME
	</select>
	
	<select id="countInDept"  resultType="_int" parameterType="selectInMajor">
	
		SELECT COUNT(*) 
		FROM HD_STUDENT_TB 
		WHERE 1=1 
		<if test='stuNo !="" &amp; stuNo != null'>
			AND STU_NO = #{stuNo}
		</if>
		<if test='stuName !="" &amp; stuName != null'>
			AND STU_NAME = #{stuName}
		</if>
		<if test='grade !="" &amp; grade != null'>
			AND SUBSTR(STU_YEAR_SEM,1,1) = #{grade}
		</if>
		AND DEPT_CODE = #{deptCode}
	</select>
	
	<!-- 수강생 조회 -->
	<select id="selectPreSubject" parameterType="professor" resultType="string">
		SELECT DISTINCT(SUB_YEAR)
		FROM HD_SUBJECT_TB A
		JOIN (SELECT SUB_CODE FROM HD_CLASS_TB WHERE PROF_ID = #{profId}) B ON(A.SUB_CODE = B.SUB_CODE)
	</select>
	<!-- 로그인한 교수가 개설중인 강의명 , 강의코드 조회 -->
	<select id="selectPreSubjectName" parameterType="professor" resultMap="subNameCodeResult">
		SELECT a.SUB_NAME, a.sub_code
		FROM HD_SUBJECT_TB A
		JOIN (SELECT SUB_CODE FROM HD_CLASS_TB WHERE PROF_ID = #{profId}) B ON(A.SUB_CODE = B.SUB_CODE)
	</select>
	
	<select id="selectInClass" parameterType="selectInClass" resultMap="inClassResult">
		SELECT STU_NO, STU_NAME, GENDER , 
		(SELECT SUB_NAME FROM HD_SUBJECT_TB WHERE SUB_CODE = #{subCode}) AS SUB_NAME,
		(SELECT SUB_CODE FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') AS SUB_CODE,
        (SELECT SUB_YEAR FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') AS SUB_YEAR,
		SUBSTR(STU_YEAR_SEM,1,1) AS GRADE,
		STU_TEL, STU_EMAIL, STU_ADDR
		
		FROM HD_STUDENT_TB
		WHERE STU_NO = (SELECT STU_NO
        FROM HD_SUB_REQ_TB
        WHERE SUB_CODE = #{subCode})
        
		<if test='grade != null &amp; grade != "" '>
			AND SUBSTR(STU_YEAR_SEM,1,1) = #{grade}
		</if>
		<if test='stuNo != null &amp; stuNo != "" '>
			AND STU_NO = #{stuNo}		
		</if>
		<if test='stuName != null &amp; stuName != "" '>
			AND STU_NAME = #{stuName}
		</if>
		<if test='subName != null &amp; subName != "" '>
			AND SUB_NAME = #{subName}
		</if>
		AND (SELECT SUB_YEAR FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') = #{subYear}
		AND (SELECT SUB_CODE FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') = #{subCode}
		
	</select>
	
	<select id="countInClass" parameterType="selectInClass" resultType="_int">
		<!-- SELECT COUNT(*),STU_NO, STU_NAME, GENDER , 
		(SELECT SUB_NAME FROM HD_SUBJECT_TB WHERE SUB_CODE = #{subCode}) AS SUB_NAME,
		SUBSTR(STU_YEAR_SEM,1,1) AS GRADE,
		STU_TEL, STU_EMAIL, STU_ADDR
		FROM HD_STUDENT_TB
		WHERE STU_NO = (SELECT STU_NO
        FROM HD_SUB_REQ_TB
        WHERE SUB_CODE = #{subCode}) -->
        SELECT COUNT(*)

		FROM    (SELECT STU_NO, STU_NAME, GENDER , 
				(SELECT SUB_NAME FROM HD_SUBJECT_TB WHERE SUB_CODE = #{subCode}) AS SUB_NAME,
				(SELECT SUB_CODE FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') AS SUB_CODE,
        		(SELECT SUB_YEAR FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') AS SUB_YEAR,
				SUBSTR(STU_YEAR_SEM,1,1) AS GRADE,
				STU_TEL, STU_EMAIL, STU_ADDR
				FROM HD_STUDENT_TB
				WHERE STU_NO = (SELECT STU_NO
		        FROM HD_SUB_REQ_TB
		        WHERE SUB_CODE = #{subCode})
		<if test='grade != null &amp; grade != "" '>
			AND SUBSTR(STU_YEAR_SEM,1,1) = #{grade}
		</if>
		<if test='stuNo != null &amp; stuNo != "" '>
			AND STU_NO = #{stuNo}		
		</if>
		<if test='stuName != null &amp; stuName != "" '>
			AND STU_NAME = #{stuName}
		</if>
		<if test='subName != null &amp; subName != "" '>
			AND (SELECT SUB_NAME FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') = #{subName}
		</if>
		AND (SELECT SUB_YEAR FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') = #{subYear}
		AND (SELECT SUB_CODE FROM HD_SUBJECT_TB WHERE SUB_CODE = 'A01-03') = #{subCode}
        )
        
		
	</select>
	
	<select id="selectClassInfo" parameterType="map" resultMap="selectClassInfoResult">
		SELECT * 
		FROM (SELECT SUB_CODE , CLASS_YEAR AS SUB_YEAR, T_SEMESTER AS SUB_SEME, 
		       (SELECT PROF_NAME FROM HD_PROFESSOR_TB WHERE PROF_ID = #{profId}) AS PROF_NAME ,
		       (SELECT PHONE FROM HD_PROFESSOR_TB WHERE PROF_ID = #{profId}) AS PHONE ,
		       (SELECT SUB_DATE FROM HD_SUBJECT_TB WHERE SUB_CODE=#{subCode}) AS SUB_DATE,
		       (SELECT SUB_TIME FROM HD_SUBJECT_TB WHERE SUB_CODE=#{subCode}) AS SUB_TIME,
		       (SELECT SUB_ROOM FROM HD_SUBJECT_TB WHERE SUB_CODE=#{subCode}) AS SUB_ROOM,
		        BOOK_NAME , 
		        (SELECT COUNT(*)
		        FROM (SELECT * 
		        FROM HD_SUB_REQ_TB
		        WHERE SUB_CODE =#{subCode})) AS CAPACITY
				FROM HD_CLASS_TB
				WHERE SUB_CODE = #{subCode})
			
	
	
	</select>
	
	<resultMap id="selectClassInfoResult" type="selectClassInfo">
		<result column="SUB_CODE" property="subCode" />
		<result column="SUB_YEAR" property="subYear" />
		<result column="SUB_SEME" property="subSeme" />
		<result column="PROF_NAME" property="profName" />
		<result column="PHONE" property="phone" />
		<result column="SUB_DATE" property="subDate" />
		<result column="SUB_TIME" property="subTime" />
		<result column="SUB_ROOM" property="subRoom" />
		<result column="BOOK_NAME" property="bookName" />
		<result column="CAPACITY" property="capacity" />
	</resultMap>



	<resultMap id="inClassResult" type="inClassStudent">
		<result column="STU_NO" property="stuNo" />
		<result column="STU_NAME" property="stuName" />
		<result column="GENDER" property="gender" />
		<result column="SUB_NAME" property="subName" />
		<result column="GRADE" property="grade" />
		<result column="STU_TEL" property="stuTel" />
		<result column="STU_EMAIL" property="stuEmail" />
		<result column="STU_ADDR" property="stuAddr" />
		<result column="ASSIGN_1" property="assign1" />
		<result column="ASSIGN_2" property="assign2" />
		<result column="ASSIGN_3" property="assign3" />
		<result column="ASSIGN_4" property="assign4" />
		<result column="M_TERM" property="mTerm" />
		<result column="F_TERM" property="fTerm" />
	</resultMap>



	<resultMap id="subNameCodeResult" type="selectSubjectNameCode">
		<result column="SUB_CODE" property="subCode" />
		<result column="SUB_NAME" property="subName" />
	</resultMap>


  <resultMap id="professorResult" type="professor">
		<result column="PROF_ID" property="profId" />
		<result column="PROF_PW" property="profPw" />
		<result column="PROF_NAME" property="profName" />
		<result column="PROF_SSN" property="profSsn" />
		<result column="DEPT_CODE" property="deptCode" />	
		<result column="EMAIL" property="email" />	
		<result column="PHONE" property="phone" />	
		<result column="ADDRESS" property="address" />	
		<result column="GENDER" property="gender" />	
		<result column="PROF_ENROLL" property="profEnroll" />	
	</resultMap>
	
	
  	<resultMap id="studentResult" type="student">
		<result column="STU_NO" property="stuNo" />
		<result column="STU_NAME" property="stuName" />
		<result column="STU_PW" property="stuPw" />
		<result column="STU_SSN" property="stuSsn" />
		<result column="STU_TEL" property="stuTel" />	
		<result column="STU_ADDR" property="stuAddr" />	
		<result column="GENDER" property="gender" />	
		<result column="DEPT_CODE" property="deptCode" />	
		<result column="ENTER_DATE" property="enterDate" />	
		<result column="STU_EMAIL" property="stuEmail" />
		<result column="REG_STATUS" property="regStatus" />	
		<result column="PROF_ID" property="profId" />	
		<result column="STU_YEAR_SEM" property="stuYearSem" />
		<result column="MAX_PSB_CR" property="maxPsbCr"/>
		<result column="CON_SEMESTER" property="conSemester" />	
		<result column="STU_IMG_ORINAME" property="stuImgOriname" />
		<result column="STU_IMG_RENAME" property="stuImgRename" />
		<result column="STU_ACCOUNT" property="stuAccount" />	
	</resultMap>
	
</mapper>
