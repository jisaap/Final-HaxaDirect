<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="student3">
	
	<select id="selectTuitionOne" parameterType="stuTuition" resultMap="tuitionResult">
		SELECT T.*, S.STU_NAME, D.DEPT_NAME, 
		TO_CHAR(TO_DATE(SUBSTR(S.STU_SSN,1,2), 'RR'), 'RRRR')||'년 '||SUBSTR(S.STU_SSN,3,2)||'월 '||SUBSTR(S.STU_SSN,5,2)||'일' AS BIRTHDAY
		FROM HD_STU_TUITION_TB T JOIN HD_STUDENT_TB S 
		ON T.STU_NO=#{stuNo} AND T.STU_NO=S.STU_NO AND ACA_YEAR_SEM=#{acaYearSem}
		JOIN HD_DEPARTMENT_TB D
		ON S.DEPT_CODE=D.DEPT_CODE
  	</select>
  	
  	<select id="selectTuitionCertList" parameterType="string" resultMap="tuitionResult">
	  	SELECT STU_NO, ACA_YEAR_SEM, PAYMENT_STAT FROM HD_STU_TUITION_TB
		WHERE STU_NO=#{studentNo}
		ORDER BY 2 DESC
	</select>
	
	<select id="selectBasicStudentInfo" parameterType="string" resultMap="tuitionResult">
		SELECT S.STU_NO, S.STU_NAME, S.STU_TEL, S.STU_ADDR, S.STU_EMAIL, D.DEPT_NAME, 
		TO_CHAR(TO_DATE(SUBSTR(S.STU_SSN,1,2), 'RR'), 'RRRR')||'년'||SUBSTR(S.STU_SSN,3,2)||'월'||SUBSTR(S.STU_SSN,5,2)||'일' AS BIRTHDAY
		FROM (SELECT * FROM HD_STUDENT_TB WHERE STU_NO=#{studentNo}) S 
		JOIN HD_DEPARTMENT_TB D
		ON S.DEPT_CODE=D.DEPT_CODE
	</select>
	
	<update id="updateTuitionOne" parameterType="stuTuition">
		UPDATE HD_STU_TUITION_TB SET PAYMENT_STAT='Y', PAYMENT_DATE=SYSDATE WHERE STU_NO=#{stuNo} AND ACA_YEAR_SEM=#{acaYearSem}
	</update>
	
	<update id="updateStuYearSem" parameterType="student">
		UPDATE HD_STUDENT_TB SET STU_YEAR_SEM=#{stuYearSem} WHERE STU_NO=#{stuNo}
	</update>
	
  	<select id="selectGraduationCon" parameterType="string" resultMap="graduationConResult">
  		SELECT GC.*, S.STU_NAME, S.STU_SSN, D.DEPT_NAME
		FROM HD_GRADUATION_CON_TB GC
		JOIN HD_STUDENT_TB S
		ON S.STU_NO=#{studentNo}
		AND GC.STU_NO=S.STU_NO
		JOIN HD_DEPARTMENT_TB D
		ON S.DEPT_CODE=D.DEPT_CODE
  	</select>
  	
  	<select id="selectStuYearSem" parameterType="string" resultType="string">
  		SELECT STU_YEAR_SEM FROM HD_STUDENT_TB WHERE STU_NO=#{studentNo}
  	</select>
  	
  	
  	<resultMap id="tuitionResult" type="stuTuition">
		<result column="STU_NO" property="stuNo" />
		<result column="STU_NAME" property="stuName" />	
		<result column="ACA_YEAR_SEM" property="acaYearSem" />
		<result column="STU_TEL" property="stuTel" />	
		<result column="TUITION" property="tuition" />
		<result column="PAYMENT_STAT" property="paymentStat" />
		<result column="PAYMENT_DATE" property="paymentDate" />	
		<result column="DUE_DATE" property="dueDate" />	
		<result column="REDUCTION_STAT" property="reductionStat" />
		<result column="DEPT_NAME" property="deptName" />	
		<result column="BIRTHDAY" property="birthday" />		
		<result column="STU_ADDR" property="stuAddr" />
		<result column="STU_EMAIL" property="stuEmail" />
	</resultMap>
	
	<resultMap id="graduationConResult" type="graduationCon">
		<result column="STU_NO" property="stuNo" />
		<result column="PSBL_MAJ_CR" property="psblMajCr" />
		<result column="MY_MAJ_CR" property="myMajCr" />
		<result column="PSBL_LIB_CR" property="psblLibCr" />
		<result column="MY_LIB_CR" property="myLibCr" />
		<result column="STU_NAME" property="stuName" />	
		<result column="STU_SSN" property="stuSSn" />
		<result column="DEPT_NAME" property="deptName" />	
	</resultMap>

  
</mapper>
