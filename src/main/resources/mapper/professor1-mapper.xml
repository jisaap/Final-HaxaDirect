<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="professor1">
	<select id="selectProfName" resultType="string">
		SELECT PROF_NAME FROM HD_PROFESSOR_TB WHERE PROF_NAME='교수1'
	</select>
	<!-- 페이징 토탈데이타 -->
	<select id="selectBoardCount" resultType="_int">
		SELECT COUNT(*) FROM HD_PROF_BOARD_TB
	</select>
	<!-- 강의 개설 -->
	<insert id="insertSubjectEnd" parameterType="map">
		INSERT INTO HD_CLASS_TB VALUES(#{subCode},#{classYear},#{profId},#{openYn},#{capacity},#{assignA},#{assignB},#{assignC},#{assignD},#{mTerm},#{fTerm},#{statusGrade},#{useBook},#{bookName},#{evaStan},#{openOther},#{oriFile},#{upFile})
	</insert>
	<select id="subjectView" resultType="map" parameterType="map">
		SELECT * FROM HD_SUBJECT_TB S JOIN HD_CLASS_TB C USING (SUB_CODE) JOIN HD_PROFESSOR_TB USING (PROF_ID) WHERE SUB_CODE = #{subCode} AND PROF_ID = #{profId}
	</select>
	<!-- 교수 뷰 -->
	<select id="professorView" resultType="professor" resultMap="professorResult1">
		SELECT * FROM HD_PROFESSOR_TB WHERE PROF_ID = #{profId}
	</select>
	
	<!-- 교수 정보수정 -->
<!-- 	<insert id="updateProfessor" parameterType="string">
		UPDATE HD_PROFESSOR_TB SET EMAIL=#{email}, PHONE=#{phone}, ADDRESS=#{address} WHERE PROF_ID=#{profId}
	</insert> -->
	
	<update id="updateProfessor" parameterType="professor">
		UPDATE HD_PROFESSOR_TB SET EMAIL=#{email}, PHONE=#{phone}, ADDRESS=#{address} WHERE PROF_ID=#{profId}
	</update>

	<!-- 비번 -->
	<update id="profUpdatePwdEnd" parameterType="map">
		UPDATE HD_PROFESSOR_TB SET PROF_PW=${profPwdUpdate} WHERE PROF_ID=#{profId} AND PROF_PW=#{profPw}
	</update>
	<!-- 게시판뷰 -->
	<select id="boardView" resultType="map">
		SELECT B.PROF_BOARD_NO, B.PROF_NAME, B.PROF_BOARD_TYPE, B.PROF_BOARD_TITLE,B.PROF_BOARD_DATE,A.BOARD_REFILENAME FROM HD_PROF_BOARD_TB B, HD_PROF_ATTACHMENT_TB A WHERE B.PROF_BOARD_NO = A.PROF_BOARD_NO(+) ORDER BY B.PROF_BOARD_DATE DESC
		<!-- SELECT A.*, (SELECT COUNT(*) FROM HD_PROF_ATTACHMENT_TB WHERE PROF_BOARD_NO = A.PROF_BOARD_NO) AS ATTACHCOUNT FROM HD_PROF_BOARD_TB A ORDER BY PROF_BOARD_DATE DESC -->
	</select>
	<!-- 게시판 작성 -->
	<insert id="insertBoardEnd" parameterType="com.kh.finalProject.professor.model.vo.ProfessorBoard">
		INSERT INTO HD_PROF_BOARD_TB VALUES(SEQ_PROF_BOARD_NO.NEXTVAL,#{profName},#{profBoardType},#{profBoardTitle},#{profBoardContent},SYSDATE)
		<selectKey keyProperty="profBoardNo" resultType="_int" order="AFTER">
			SELECT SEQ_PROF_BOARD_NO.CURRVAL FROM DUAL
		</selectKey>
	</insert>
	<insert id="insertBoardAttachment" parameterType="com.kh.finalProject.professor.model.vo.ProfBoardAttachment">
		INSERT INTO HD_PROF_ATTACHMENT_TB VALUES(SEQ_PROF_BOARD_FILENO.NEXTVAL,#{profBoardNo},#{boardOrifilename},#{boardRefilename},DEFAULT)
	</insert>
	<!-- 게시판 수정 -->
	<update id="updateBoardEnd" parameterType="com.kh.finalProject.professor.model.vo.ProfessorBoard">
		UPDATE HD_PROF_BOARD_TB SET PROF_BOARD_TYPE=#{profBoardType},PROF_BOARD_TITLE=#{profBoardTitle},PROF_BOARD_CONTENT=#{profBoardContent} WHERE PROF_BOARD_NO=#{profBoardNo}
	</update>
	<update id="updateAttachment" parameterType="com.kh.finalProject.professor.model.vo.ProfBoardAttachment">
		UPDATE HD_PROF_ATTACHMENT_TB SET BOARD_ORIFILENAME=#{boardOrifilename},BOARD_REFILENAME=#{boardRefilename} WHERE PROF_BOARD_NO=#{profBoardNo}
	</update>
	<!-- 게시판 상세 -->
	<select id="selectBoardView" parameterType="_int" resultMap="professorBoardMap">
		SELECT * FROM HD_PROF_BOARD_TB WHERE PROF_BOARD_NO=#{profBoardNo}
	</select>
	<select id="selectProfAttachment" parameterType="_int" resultMap="profBoardAttachment">
		SELECT * FROM HD_PROF_ATTACHMENT_TB WHERE PROF_BOARD_NO=#{profBoardNo}
	</select>
	
	<resultMap type="com.kh.finalProject.professor.model.vo.ProfessorBoard" id="professorBoardMap">
		<result column="PROF_BOARD_NO" property="profBoardNo"/>
		<result column="PROF_NAME" property="profName"/>
		<result column="PROF_BOARD_TYPE" property="profBoardType"/>
		<result column="PROF_BOARD_TITLE" property="profBoardTitle"/>
		<result column="PROF_BOARD_CONTENT" property="profBoardContent"/>
		<result column="PROF_BOARD_DATE" property="profBoardDate"/>
		<result column="PROF_BOARD_NOTICE" property="profBoardNotice"/>
	</resultMap>
	<resultMap type="com.kh.finalProject.professor.model.vo.ProfBoardAttachment" id="profBoardAttachment">
		<result column="PROF_BOARD_NO" property="profBoardNo"/>
		<result column="BOARD_FILENO" property="boardFileNo"/>
		<result column="BOARD_ORIFILENAME" property="boardOrifilename"/>
		<result column="BOARD_REFILENAME" property="boardRefilename"/>
		<result column="BOARD_UPLOADDATE" property="boardUploaddate"/>
	</resultMap>
	
	<!-- subject -->
	<select id="subjectCodeView" resultType="map">
		SELECT S.*,P.DEPT_CODE,P.PROF_NAME FROM HD_SUBJECT_TB S,HD_PROFESSOR_TB P WHERE S.DEPT_CODE = P.DEPT_CODE(+) AND P.PROF_ID=#{profId}
	</select>
	<select id="selectSubject" resultType="map" parameterType="string">
		SELECT * FROM HD_SUBJECT_TB WHERE SUB_CODE = #{subCode}
	</select>
	
	
	
	
	
	
 <resultMap id="professorResult1" type="professor">
	<result column="PROF_ID" property="profId" />
	<result column="PROF_PW" property="profPw" />
	<result column="PROF_NAME" property="profName" />
	<result column="PROF_SSN" property="profSsn" />
	<result column="DEPT_CODE" property="deptCode" />	
	<result column="EMAIL" property="email" />	
	<result column="PHONE" property="phone" />	
	<result column="ADDRESS" property="address" />	
	<result column="GENDER" property="gender" />	
	<result column="PROF_ENROLL" property="profEnroll" />	
</resultMap>

	
</mapper>
